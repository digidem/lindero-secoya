<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui' />
    <title>Secoya Land Invasion</title>
    <script src='assets/mapbox.js'></script>
    <script src='assets/leaflet-hash.js'></script>
    <link href='assets/mapbox.css' rel='stylesheet' />
    <link href='assets/range-input.css' rel='stylesheet' />
    <style>
    body {
        margin: 0;
        padding: 0;
    }
    #range {
        position: absolute;
        top: 50%;
        width: 100%;
    }
    #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
    }
    #divider {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        width: 4px;
        background-color: #fff;
        pointer-events: none;
    }
    *, *:after, *:before {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }
    </style>
</head>

<body>
    <div id='map'></div>
    <div id='divider'></div>
    <input id='range' type='range' min='0' max='1.0' step='any' />

    <script>
    L.mapbox.accessToken = 'pk.eyJ1IjoiZ21hY2xlbm5hbiIsImEiOiJSaWVtd2lRIn0.ASYMZE2HhwkAw4Vt7SavEg';

    var boundary = {
        "type": "FeatureCollection",
        "features": [{
            "type": "Feature",
            "properties": {
                "color": "#f1f075",
                "weight": 4,
                "opacity": 0.8,
                "fill": false
            },
            "geometry": {
                "coordinates": [
                    [
                        [-76.256045, -0.396874],
                        [-76.256748, -0.397402],
                        [-76.259055, -0.396191],
                        [-76.261655, -0.395996],
                        [-76.264427, -0.396305],
                        [-76.266175, -0.395984],
                        [-76.265303, -0.397477],
                        [-76.266214, -0.398344],
                        [-76.267985, -0.398617],
                        [-76.268971, -0.400398],
                        [-76.270011, -0.399533],
                        [-76.270562, -0.400877],
                        [-76.271739, -0.401409],
                        [-76.27274, -0.400792],
                        [-76.272987, -0.402333],
                        [-76.273715, -0.403276],
                        [-76.277057, -0.403546],
                        [-76.277734, -0.403092],
                        [-76.279026, -0.403273],
                        [-76.279328, -0.401607],
                        [-76.280916, -0.401562],
                        [-76.281709, -0.401966],
                        [-76.282648, -0.401489],
                        [-76.284739, -0.40187],
                        [-76.286785, -0.401094],
                        [-76.288383, -0.399998],
                        [-76.290866, -0.399695],
                        [-76.290945, -0.401943],
                        [-76.292038, -0.403133],
                        [-76.292259, -0.404351],
                        [-76.293654, -0.404994],
                        [-76.295408, -0.404393],
                        [-76.297063, -0.404595],
                        [-76.297421, -0.405237],
                        [-76.296666, -0.406851],
                        [-76.298402, -0.40653],
                        [-76.29959, -0.409642],
                        [-76.301876, -0.410257],
                        [-76.301763, -0.41122],
                        [-76.303277, -0.412103],
                        [-76.304712, -0.412425],
                        [-76.305789, -0.412065],
                        [-76.307423, -0.412828],
                        [-76.309075, -0.412202],
                        [-76.310438, -0.41266],
                        [-76.310424, -0.411387],
                        [-76.312489, -0.411933],
                        [-76.31273, -0.413239],
                        [-76.314459, -0.413194],
                        [-76.314537, -0.416479],
                        [-76.315852, -0.416887],
                        [-76.317447, -0.415844],
                        [-76.31956, -0.415364],
                        [-76.318644, -0.414199],
                        [-76.318979, -0.413308],
                        [-76.320126, -0.414075],
                        [-76.32104, -0.411737],
                        [-76.322074, -0.411793],
                        [-76.322611, -0.413276],
                        [-76.323987, -0.411955],
                        [-76.325642, -0.411274],
                        [-76.324805, -0.410471],
                        [-76.325524, -0.409026],
                        [-76.326535, -0.410139],
                        [-76.328035, -0.40987],
                        [-76.329034, -0.407714],
                        [-76.331146, -0.406782],
                        [-76.33347, -0.406489],
                        [-76.333353, -0.40517],
                        [-76.334517, -0.404658],
                        [-76.334745, -0.403769],
                        [-76.336091, -0.403465],
                        [-76.337995, -0.402452],
                        [-76.339003, -0.401449],
                        [-76.339143, -0.399964],
                        [-76.337528, -0.399561],
                        [-76.338387, -0.397796],
                        [-76.339362, -0.398337],
                        [-76.339624, -0.396191],
                        [-76.341617, -0.39559],
                        [-76.341051, -0.393368],
                        [-76.342536, -0.392099],
                        [-76.341341, -0.390574],
                        [-76.341541, -0.390052],
                        [-76.343854, -0.388287],
                        [-76.347243, -0.388249],
                        [-76.34788, -0.389574],
                        [-76.349474, -0.390899],
                        [-76.352005, -0.391302],
                        [-76.352603, -0.39078],
                        [-76.354716, -0.392146],
                        [-76.35627, -0.392388],
                        [-76.357706, -0.392188],
                        [-76.358223, -0.393994],
                        [-76.359219, -0.394597],
                        [-76.360456, -0.394036],
                        [-76.36177, -0.395321],
                        [-76.361451, -0.396404],
                        [-76.362846, -0.396485],
                        [-76.363804, -0.395563],
                        [-76.368368, -0.395927],
                        [-76.369325, -0.396248],
                        [-76.371677, -0.395808],
                        [-76.372674, -0.39629],
                        [-76.374667, -0.39605],
                        [-76.375584, -0.396372],
                        [-76.375784, -0.394767],
                        [-76.375148, -0.392077],
                        [-76.3777, -0.392199],
                        [-76.379255, -0.391036],
                        [-76.379775, -0.393127],
                        [-76.38096, -0.393108],
                        [-76.407082, -0.394888],
                        [-76.408507, -0.325898],
                        [-76.454855, -0.31327],
                        [-76.455974, -0.311957],
                        [-76.455122, -0.306814],
                        [-76.455822, -0.300197],
                        [-76.459079, -0.295906],
                        [-76.467403, -0.294174],
                        [-76.470109, -0.293725],
                        [-76.481469, -0.293721],
                        [-76.481484, -0.288652],
                        [-76.481069, -0.287325],
                        [-76.483642, -0.286186],
                        [-76.485437, -0.285828],
                        [-76.485027, -0.284663],
                        [-76.486826, -0.283081],
                        [-76.488583, -0.283084],
                        [-76.490642, -0.281714],
                        [-76.491222, -0.280764],
                        [-76.490514, -0.279489],
                        [-76.489221, -0.279058],
                        [-76.490054, -0.278121],
                        [-76.486977, -0.276452],
                        [-76.488036, -0.27586],
                        [-76.488517, -0.273431],
                        [-76.487552, -0.272451],
                        [-76.488736, -0.271289],
                        [-76.488471, -0.270501],
                        [-76.48719, -0.269205],
                        [-76.488256, -0.268082],
                        [-76.489339, -0.268368],
                        [-76.489829, -0.267058],
                        [-76.491515, -0.266276],
                        [-76.49277, -0.266317],
                        [-76.49231, -0.268894],
                        [-76.493564, -0.2693],
                        [-76.494738, -0.266938],
                        [-76.494221, -0.265366],
                        [-76.495507, -0.264717],
                        [-76.496977, -0.265903],
                        [-76.49739, -0.264298],
                        [-76.499282, -0.263029],
                        [-76.498987, -0.261929],
                        [-76.497747, -0.261243],
                        [-76.495448, -0.262012],
                        [-76.495227, -0.261421],
                        [-76.496238, -0.259684],
                        [-76.497472, -0.258984],
                        [-76.498817, -0.258965],
                        [-76.499746, -0.259448],
                        [-76.500308, -0.258213],
                        [-76.498931, -0.257089],
                        [-76.499103, -0.254782],
                        [-76.500672, -0.25368],
                        [-76.500974, -0.252637],
                        [-76.502128, -0.252398],
                        [-76.50219, -0.251466],
                        [-76.503615, -0.249581],
                        [-76.501776, -0.249108],
                        [-76.502271, -0.248308],
                        [-76.503622, -0.248383],
                        [-76.502739, -0.245539],
                        [-76.503194, -0.244952],
                        [-76.505375, -0.245576],
                        [-76.505482, -0.244663],
                        [-76.506554, -0.243376],
                        [-76.508146, -0.243265],
                        [-76.507668, -0.241808],
                        [-76.509134, -0.241955],
                        [-76.510546, -0.241591],
                        [-76.511059, -0.240781],
                        [-76.510542, -0.239758],
                        [-76.510363, -0.237876],
                        [-76.511087, -0.236639],
                        [-76.515657, -0.23473],
                        [-76.51716, -0.234808],
                        [-76.517106, -0.233395],
                        [-76.518228, -0.232683],
                        [-76.517536, -0.230702],
                        [-76.518899, -0.231386],
                        [-76.519749, -0.23123],
                        [-76.519306, -0.22893],
                        [-76.520565, -0.228554],
                        [-76.521412, -0.227168],
                        [-76.522357, -0.228434],
                        [-76.524181, -0.228746],
                        [-76.523561, -0.229782],
                        [-76.524908, -0.230562],
                        [-76.526612, -0.230455],
                        [-76.527268, -0.231382],
                        [-76.528162, -0.230174],
                        [-76.527099, -0.228563],
                        [-76.527702, -0.227398],
                        [-76.526829, -0.226136],
                        [-76.528179, -0.225402],
                        [-76.528688, -0.224181],
                        [-76.531013, -0.222288],
                        [-76.531169, -0.220265],
                        [-76.531933, -0.218928],
                        [-76.53361, -0.219065],
                        [-76.534536, -0.220197],
                        [-76.535565, -0.219506],
                        [-76.535898, -0.218609],
                        [-76.537415, -0.216978],
                        [-76.537564, -0.216071],
                        [-76.539485, -0.2155],
                        [-76.540388, -0.215891],
                        [-76.541595, -0.214342],
                        [-76.544342, -0.213149],
                        [-76.546021, -0.212948],
                        [-76.546307, -0.211844],
                        [-76.550164, -0.210472],
                        [-76.551331, -0.210679],
                        [-76.551798, -0.208585],
                        [-76.550919, -0.206356],
                        [-76.540072, -0.199583],
                        [-76.54487, -0.194147],
                        [-76.538548, -0.188879],
                        [-76.536605, -0.18916],
                        [-76.535237, -0.186246],
                        [-76.534096, -0.188587],
                        [-76.531942, -0.190325],
                        [-76.530431, -0.190898],
                        [-76.529755, -0.192759],
                        [-76.528415, -0.193473],
                        [-76.527351, -0.193338],
                        [-76.524779, -0.191941],
                        [-76.523838, -0.191882],
                        [-76.523239, -0.192851],
                        [-76.52456, -0.193745],
                        [-76.523921, -0.194668],
                        [-76.521872, -0.195717],
                        [-76.520316, -0.195076],
                        [-76.520546, -0.197308],
                        [-76.520093, -0.198022],
                        [-76.517139, -0.196715],
                        [-76.517144, -0.195078],
                        [-76.517905, -0.193965],
                        [-76.516663, -0.193143],
                        [-76.51626, -0.194642],
                        [-76.515233, -0.195621],
                        [-76.513262, -0.195157],
                        [-76.512594, -0.194232],
                        [-76.512956, -0.192037],
                        [-76.5124, -0.190621],
                        [-76.511272, -0.189694],
                        [-76.510308, -0.191088],
                        [-76.508561, -0.191652],
                        [-76.507593, -0.190003],
                        [-76.505784, -0.18865],
                        [-76.50564, -0.186766],
                        [-76.503954, -0.186272],
                        [-76.502912, -0.186781],
                        [-76.502455, -0.188348],
                        [-76.500682, -0.189929],
                        [-76.498957, -0.190483],
                        [-76.495945, -0.18984],
                        [-76.492462, -0.188165],
                        [-76.48999, -0.188159],
                        [-76.48736, -0.192315],
                        [-76.484114, -0.198805],
                        [-76.482508, -0.201255],
                        [-76.480737, -0.204882],
                        [-76.479561, -0.208334],
                        [-76.480211, -0.209481],
                        [-76.481494, -0.209556],
                        [-76.484517, -0.212195],
                        [-76.486751, -0.215919],
                        [-76.487302, -0.218142],
                        [-76.488148, -0.219996],
                        [-76.488535, -0.222849],
                        [-76.488391, -0.224589],
                        [-76.487868, -0.226245],
                        [-76.487032, -0.227106],
                        [-76.485349, -0.227098],
                        [-76.483687, -0.22573],
                        [-76.482525, -0.225278],
                        [-76.481014, -0.22404],
                        [-76.478795, -0.22064],
                        [-76.477387, -0.219829],
                        [-76.47589, -0.220084],
                        [-76.474636, -0.22196],
                        [-76.47441, -0.224039],
                        [-76.472702, -0.225656],
                        [-76.46964, -0.227929],
                        [-76.466774, -0.228617],
                        [-76.464909, -0.230215],
                        [-76.46372, -0.232119],
                        [-76.463246, -0.234302],
                        [-76.463886, -0.235493],
                        [-76.466607, -0.239445],
                        [-76.467753, -0.241387],
                        [-76.467867, -0.242616],
                        [-76.467002, -0.245109],
                        [-76.463653, -0.247687],
                        [-76.46073, -0.248444],
                        [-76.458223, -0.24803],
                        [-76.457007, -0.247526],
                        [-76.453707, -0.24523],
                        [-76.45045, -0.243369],
                        [-76.446098, -0.240546],
                        [-76.444832, -0.240368],
                        [-76.443741, -0.239653],
                        [-76.442391, -0.239736],
                        [-76.43992, -0.241982],
                        [-76.438407, -0.243918],
                        [-76.436925, -0.2469],
                        [-76.4348, -0.24849],
                        [-76.431134, -0.249932],
                        [-76.428643, -0.251247],
                        [-76.426981, -0.252421],
                        [-76.425885, -0.254027],
                        [-76.42581, -0.255662],
                        [-76.426565, -0.261393],
                        [-76.427796, -0.26529],
                        [-76.427912, -0.267062],
                        [-76.427677, -0.268996],
                        [-76.426736, -0.271546],
                        [-76.424997, -0.273683],
                        [-76.423525, -0.2761],
                        [-76.423033, -0.277595],
                        [-76.423113, -0.278699],
                        [-76.424555, -0.280063],
                        [-76.428093, -0.281134],
                        [-76.430129, -0.282394],
                        [-76.430176, -0.284013],
                        [-76.430651, -0.285759],
                        [-76.430029, -0.288147],
                        [-76.428769, -0.289181],
                        [-76.427083, -0.289434],
                        [-76.424609, -0.288621],
                        [-76.422078, -0.288292],
                        [-76.420469, -0.28854],
                        [-76.41712, -0.28969],
                        [-76.416048, -0.290349],
                        [-76.414811, -0.291987],
                        [-76.413989, -0.294223],
                        [-76.412565, -0.297133],
                        [-76.411737, -0.298125],
                        [-76.410274, -0.298587],
                        [-76.406326, -0.299028],
                        [-76.403477, -0.299022],
                        [-76.404402, -0.316475],
                        [-76.358351, -0.310144],
                        [-76.353314, -0.306411],
                        [-76.331886, -0.306387],
                        [-76.331818, -0.30508],
                        [-76.321921, -0.312246],
                        [-76.321903, -0.308804],
                        [-76.227763, -0.306346],
                        [-76.230123, -0.392479],
                        [-76.234294, -0.396866],
                        [-76.235104, -0.396827],
                        [-76.235981, -0.39771],
                        [-76.238612, -0.396267],
                        [-76.23856, -0.393833],
                        [-76.240752, -0.394329],
                        [-76.242614, -0.391307],
                        [-76.244899, -0.391843],
                        [-76.246599, -0.392888],
                        [-76.247157, -0.392353],
                        [-76.24891, -0.39321],
                        [-76.248591, -0.394601],
                        [-76.24968, -0.394815],
                        [-76.251223, -0.395889],
                        [-76.251664, -0.396967],
                        [-76.253349, -0.397491],
                        [-76.254687, -0.396731],
                        [-76.256045, -0.396874]
                    ]
                ],
                "type": "Polygon"
            },
            "id": "ci9bpz2051t34i2m8f6wy1bzo"
        }],
        "id": "gmaclennan.k8p70baj"
    }


    // Set max bounds for the map to keep us focussed on the area of interest
    var southWest = L.latLng(-0.48, -76.544),
        northEast = L.latLng(-0.277, -76.25),
        bounds = L.latLngBounds(southWest, northEast);

    var map = L.map('map', {
        attributionControl: false,
        maxBounds: bounds,
        maxZoom: 20,
        minZoom: 8
    }).setView([-0.39477, -76.40277], 17);

    if (window.location.protocol === 'file:') {
        L.tileLayer('assets/tiles/gmaclennan.k8p70baj/{z}/{x}/{y}.jpg').addTo(map)
        L.geoJson(boundary, {
          style: function (feature) {
            return feature.properties
          }
        }).addTo(map)
        var overlay = L.tileLayer('assets/tiles/gmaclennan.0794f5ed/{z}/{x}/{y}.png').addTo(map);
    } else {
        L.mapbox.tileLayer('gmaclennan.k8p70baj').addTo(map)
        L.mapbox.featureLayer('gmaclennan.k8p70baj').addTo(map)
        var overlay = L.mapbox.tileLayer('gmaclennan.0794f5ed').setFormat('png256').addTo(map);
    }

    // Keep the URL updated with a hash of the current position
    var hash = L.hash(map);


    var range = document.getElementById('range');
    var divider = document.getElementById('divider');

    overlay.on('ready', function() {
        // This seems to fix a problem with the clip not updating when zooming the map
        if (L.Browser.webkit3d) overlay.getContainer().style.transform = "translate3d(0,0,0)";
    })

    function clip() {
        var nw = map.containerPointToLayerPoint([0, 0]),
            se = map.containerPointToLayerPoint(map.getSize()),
            offset = (0.5 - range.value) * 44,
            clipX = nw.x + (se.x - nw.x) * range.value + offset;

        divider.style.left = map.getSize().x * range.value - 2 + offset + 'px';
        overlay.getContainer().style.clip = 'rect(' + [nw.y, clipX, se.y, nw.x].join('px,') + 'px)';
    }

    range['oninput' in range ? 'oninput' : 'onchange'] = clip;
    map.on('move', clip);

    clip();
    </script>
</body>
</html>
